<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WSJF Live Voting – Final Polish</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #f7f9fc; }
  h1 { text-align: center; color: #2c3e50; }
  .container { max-width: 1100px; margin: auto; }
  .controls {
    text-align: center;
    margin: 20px 0;
    padding: 20px;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  }

  /* === ALL BUTTONS SAME SIZE + HOVER EFFECT === */
  .btn {
    padding: 16px 32px;
    margin: 8px;
    font-size: 18px;
    font-weight: bold;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 220px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  }

  .btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.25);
  }

  .btn-start { background: #e74c3c; }
  .btn-start:hover { background: #c0392b; }

  .btn-reveal { background: #3498db; }
  .btn-reveal:hover { background: #2980b9; }
  .btn-reveal:disabled { background: #95a5a6; cursor: not-allowed; transform: none; }

  .btn-reset { background: #e67e22; }
  .btn-reset:hover { background: #d35400; }

  .btn-export { background: #27ae60; }
  .btn-export:hover { background: #219a52; }

  .btn-confirm {
    padding: 16px 40px !important;
    font-size: 22px !important;
    background: #27ae60;
  }
  .btn-confirm:hover { background: #219a52; }

  select {
    padding: 12px 16px;
    font-size: 18px;
    border-radius: 8px;
    margin: 8px;
  }

  #itemDisplay {
    font-size: 30px;
    font-weight: bold;
    text-align: center;
    margin: 40px 0;
    min-height: 100px;
    color: #2c3e50;
  }

  .fib {
    font-size: 48px;
    padding: 20px;
    margin: 12px;
    cursor: pointer;
    border: 4px solid #3498db;
    border-radius: 16px;
    display: inline-block;
    width: 100px;
    text-align: center;
    background: white;
    user-select: none;
    transition: all 0.2s;
  }
  .fib:hover { transform: scale(1.1); }
  .fib.selected { background: #3498db; color: white; }
  .fib.revealed { border-color: #27ae60; background: #ecf0f1; }

  .vote { font-size: 24px; margin: 8px; padding: 10px 16px; background:#ecf0f1; border-radius:8px; }

  .median { font-size: 70px; font-weight: bold; color: #27ae60; }

  table { width: 100%; margin-top: 20px; border-collapse: collapse; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
  th, td { padding: 14px; text-align: center; border-bottom: 1px solid #ddd; }
  th { background: #2c3e50; color: white; }
  .done { background:#d5f5e3; }
</style>
</head>
<body>
<div class="container">
  <h1>WSJF Live Voting – Cost of Delay</h1>

  <div class="controls">
    <select id="round">
      <option value="Business Value">1. User-Business Value</option>
      <option value="Time Criticality">2. Time Criticality</option>
      <option value="RR/OE">3. RR/OE Value</option>
    </select>

    <br><br>

    <button class="btn btn-start" id="nextBtn" onclick="nextItem()">Start / Next Item</button>
    <button class="btn btn-reveal" id="revealBtn" onclick="reveal()" disabled>Reveal Votes</button>
    <button class="btn btn-reset" onclick="resetAll()">Reset All</button>
    <button class="btn btn-export" onclick="exportCSV()">Export as CSV</button>
  </div>

  <div id="itemDisplay">Click “Start / Next Item” to begin</div>

  <div style="text-align:center; margin:40px;">
    <div class="fib" data-val="1">1</div>
    <div class="fib" data-val="2">2</div>
    <div class="fib" data-val="3">3</div>
    <div class="fib" data-val="5">5</div>
    <div class="fib" data-val="8">8</div>
    <div class="fib" data-val="13">13</div>
  </div>

  <div id="currentVotes" style="text-align:center; min-height:70px; font-size:20px;"></div>
  <div id="results"></div>

  <h2 style="text-align:center; margin-top:40px;">Results Table</h2>
  <table id="resultsTable">
    <thead>
      <tr>
        <th>Item</th>
        <th>Business Value</th>
        <th>Time Criticality</th>
        <th>RR/OE</th>
        <th>Cost of Delay</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
// ==== EDIT YOUR BACKLOG HERE ====
const backlog = [
  "Login with SSO",
  "Mobile responsive dashboard",
  "Payment gateway integration",
  "Real-time notifications",
  "Export to PDF/Excel",
  "Multi-language support",
  "Audit log for compliance",
  "Performance optimisations",
  "Dark mode",
  "Bulk user import",
  "Advanced search & filters",
  "API rate-limiting"
];
// ================================

let currentItemIndex = -1;
let votes = {};
let results = {};

// Load saved results
if (localStorage.getItem('wsjfResults2025')) {
  results = JSON.parse(localStorage.getItem('wsjfResults2025'));
}
renderTable();

function nextItem() {
  currentItemIndex++;
  if (currentItemIndex >= backlog.length) {
    alert("All items completed! Use Export as CSV to save your results.");
    return;
  }
  resetRound();
  document.getElementById('itemDisplay').textContent = 
    `Item ${currentItemIndex+1}/${backlog.length}: ${backlog[currentItemIndex]}`;
  document.getElementById('revealBtn').disabled = false;
  document.getElementById('revealBtn').textContent = "Reveal Votes";
}

function resetRound() {
  votes = {};
  document.getElementById('currentVotes').innerHTML = '';
  document.getElementById('results').innerHTML = '';
  document.querySelectorAll('.fib').forEach(el => el.classList.remove('selected','revealed'));
}

document.querySelectorAll('.fib').forEach(card => {
  card.addEventListener('click', function() {
    if (document.getElementById('revealBtn').disabled) return;
    const val = parseInt(this.dataset.val);
    const name = prompt("Your name?", "") || "Anon";
    votes[name] = val;
    document.querySelectorAll('.fib').forEach(c => c.classList.remove('selected'));
    this.classList.add('selected');
    let html = "<strong>Votes so far:</strong> ";
    for (const [n,v] of Object.entries(votes)) html += `<span class="vote">${n}: ${v}</span> `;
    document.getElementById('currentVotes').innerHTML = html;
  });
});

function reveal() {
  if (Object.keys(votes).length === 0) return;
  const values = Object.values(votes).sort((a,b)=>a-b);
  const mid = Math.floor(values.length / 2);
  const median = values.length % 2 === 0 ? Math.round((values[mid-1] + values[mid])/2) : values[mid];

  document.getElementById('results').innerHTML = `
    <h2>Median = <span class="median">${median}</span></h2>
    <p>Votes: ${values.join(', ')}</p>
    <button class="btn btn-confirm" onclick="saveResult(${median})">
      Confirm & Save ${median}
    </button>
  `;
  document.querySelectorAll('.fib').forEach(c => c.classList.add('revealed'));
  document.getElementById('revealBtn').disabled = true;
  document.getElementById('revealBtn').textContent = "Revealed";
}

function saveResult(score) {
  const item = backlog[currentItemIndex];
  const round = document.getElementById('round').value;
  if (!results[item]) results[item] = {};

  if (round === "Business Value") results[item].bv = score;
  if (round === "Time Criticality") results[item].tc = score;
  if (round === "RR/OE") results[item].rroe = score;

  results[item].cod = (results[item].bv || 0) + (results[item].tc || 0) + (results[item].rroe || 0);

  localStorage.setItem('wsjfResults2025', JSON.stringify(results));
  renderTable();
  setTimeout(nextItem, 800);
}

function renderTable() {
  const tbody = document.querySelector('#resultsTable tbody');
  tbody.innerHTML = '';
  backlog.forEach(item => {
    const r = results[item] || {};
    const rowClass = (r.bv && r.tc && r.rroe) ? 'done' : '';
    tbody.innerHTML += `
      <tr class="${rowClass}">
        <td><strong>${item}</strong></td>
        <td>${r.bv || '-'}</td>
        <td>${r.tc || '-'}</td>
        <td>${r.rroe || '-'}</td>
        <td><strong>${r.cod > 0 ? r.cod : '-'}</strong></td>
      </tr>`;
  });
}

function exportCSV() {
  let csv = "Item,Business Value,Time Criticality,RR/OE,Cost of Delay\n";
  backlog.forEach(item => {
    const r = results[item] || {};
    csv += `"${item.replace(/"/g, '""')}",${r.bv||''},${r.tc||''},${r.rroe||''},${r.cod > 0 ? r.cod : ''}\n`;
  });
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.setAttribute('href', url);
  link.setAttribute('download', `WSJF_CostOfDelay_${new Date().toISOString().slice(0,10)}.csv`);
  link.style.visibility = 'hidden';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

function resetAll() {
  if (confirm("Delete all results and start over?")) {
    localStorage.removeItem('wsjfResults2025');
    results = {};
    currentItemIndex = -1;
    renderTable();
    document.getElementById('itemDisplay').textContent = "Click “Start / Next Item” to begin";
    resetRound();
  }
}
</script>
</body>
</html>
